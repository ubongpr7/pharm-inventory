{% extends "dashboard/wrapper/base.html" %}
{% load static %}
{% load bootstrap5 %}
{% block more_meta_tags %}
{% endblock more_meta_tags %}

{% block page_title %}
   Create {{ title }} 
{% endblock page_title %}

{% block extra_style %}
<style>
    .add-cat{
        color: #111;
        /* width: 3rem;
        height: 3rem; */
        /* align-self: normal ; */
        /* text-align: left; */
        margin-left: -5px;
        background-color: transparent;
        cursor: pointer;
        align-items: center;
        text-align: center;
    }
</style>
{% endblock extra_style %}

{% block content %}
<div class="container mt-4" >
    <div class="container mx-auto p-4 w-3/4">
        <div class="card">
            <div class="card-body " >
                <div class="card-body">
                    <h3 class="card-title">Add new {{ title }} </h3>
                    <form action="." method="post" class="form in-d-flex in-align-center in-justify-center">
                        {% csrf_token %}
                        <div class="col-lg-12 col-md-12 col-sm-12">
                          <div class="row in-d-flex in-align-center in-justify-center">
                            {% for field in form %}
                                {% if field.name == 'category' %}

                                <div class="col-md-3 col-sm-6 in-d-flex in-align-center ">
                                  <div class="col-10">
                                    
                                      {% bootstrap_field field %}
                                  </div>
                                  <button class="col-3 bi add-cat"  onclick="my_modal_1.showModal()">

                                      <i class="col-3 bi  in-fw-bld bi-plus in-fs-20 " hx-get="{% url 'inventory:add_inventory_category'  %}" hx-trigger="click" hx-target="#modal-form" data-add-category=""></i>
                                  </button>
                                  
                    
                                </div>
                                {% elif field.name == 'description' %}
                                <div class="col-md-6 col-sm-12">
                                  {% bootstrap_field field %}
                    
                                </div>
                                {% else %}
                                <div class="col-md-3 col-sm-6">
                                  {% bootstrap_field field %}
                    
                                </div>
                                {% endif %}
                            {% endfor %}
                            {% buttons %}
                              <button type="submit" class="btn btn-primary">
                                Submit
                              </button>
                            {% endbuttons %}
                          </div>
                        </div>
                    
                    </form>
                </div>                 
            </div>
        </div>
        
    </div>
    
    <div id="sub-form">
    
    </div>
</div>

<!-- <button class="btn" onclick="my_modal_1.showModal()">open modal</button> -->
<dialog id="my_modal_1" class="modal">
  <div class="modal-box">
    
    <div class="modal-action" id="modal-form">

    </div>
  </div>
</dialog>
{% endblock content %}

{% block extra_script %}
<script type="module" src="{% static 'assets/js/create_ajax.js' %}"></script>
<script>
    document.addEventListener("htmx:afterRequest",(event)=>{
        if (event.detail.target.id ==="model-body"){
            var modal =new bootstrap.Modal(document.getElementById('sub-form'));
            modal.show();
            console.log('shown')

        }
    })
    document.addEventListener('htmx:afterRequest',(e)=>{
        if (e.detail.verb ==="POST"){
            
            let newCategory=event.detail.xhr.response;
            let select=document.getElementById('id_category');
            let option=document.createElement('option');
            option.value=newCategory.id
            option.text=newCategory.name
            select.add(option);
            select.value=newCategory.id
            let modal =bootstrap.Modal.getInstance(document.getElementById('sub-form'))
            modal.hide();
        }
    })
</script>
{% endblock extra_script %}